{
  "$schema": "https://json-schema.org/draft/2019-09/schema",
  "definitions": {
    "KeyExchange" : {
      "type" : "string",
      "enum": ["X25519", "Secp256k1", "P256"]
    },
    "SymmetricAlgo" : {
      "type" : "string",
      "enum": ["AES_256_CTR"]
    },
    "KDF" : {
      "type" : "string",
      "enum": ["HKDF_SHA256"]
    },
    "ENC" : {
      "type" : "object",
      "description" : "Encryption Header containing all parameters needed for decryption",
      "properties" : {
        "VERSION" : {
                "type" : "integer", "minimum" : 0, "maximum" :255,
                "description" : "Schema version for forward compatibility"
              },
        "KEY_EXCHANGE" : {
                "$ref" : "#/definitions/KeyExchange",
                "description" : "Key exchange algorithm used"
              },
        "SYMMETRIC" : {
                "$ref" : "#/definitions/SymmetricAlgo",
                "description" : "Symmetric encryption algorithm used"
              },
        "KEY_DERIVATION" : {
                "$ref" : "#/definitions/KDF",
                "description" : "Key derivation function used"
              },
        "EPHEMERAL_PUBLIC_KEY" : {
                "type" : "array", "items" : {"type" : "integer", "minimum" : 0, "maximum" :255},
                "description" : "Ephemeral public key for ECDH key agreement (32-65 bytes depending on algorithm)"
              },
        "NONCE_START" : {
                "type" : "array", "items" : {"type" : "integer", "minimum" : 0, "maximum" :255},
                "description" : "Random 12-byte nonce starting value. Incremented for each record in the stream to ensure unique nonces."
              },
        "RECIPIENT_KEY_ID" : {
                "type" : "array", "items" : {"type" : "integer", "minimum" : 0, "maximum" :255},
                "description" : "Optional identifier for the recipient's public key (up to 32 bytes)"
              },
        "CONTEXT" : {
                "type" : "string",
                "description" : "Optional domain separation context string"
              },
        "SCHEMA_HASH" : {
                "type" : "array", "items" : {"type" : "integer", "minimum" : 0, "maximum" :255},
                "description" : "Optional SHA-256 hash of the FlatBuffers schema (32 bytes)"
              },
        "ROOT_TYPE" : {
                "type" : "string",
                "description" : "Optional root type name from the schema"
              },
        "TIMESTAMP" : {
                "type" : "integer", "minimum" : 0, "maximum" : 18446744073709551615,
                "description" : "Optional Unix timestamp (milliseconds) when encryption was performed"
              }
      },
      "required" : ["EPHEMERAL_PUBLIC_KEY", "NONCE_START"],
      "additionalProperties" : false
    }
  },
  "$ref" : "#/definitions/ENC"
}
